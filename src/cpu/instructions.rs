use num_enum::TryFromPrimitive;

pub const OP_MASK: u8 = 0x03;
pub const ADDR_MODE_MASK: u8 = 0x1C;
pub const ADDR_MODE_SHIFT: u8 = 0x02;
pub const INST_MODE_MASK: u8 = 0xE0; // 0b11100000
pub const INST_MODE_SHIFT: u8 = 0x05; // We only care about first 3 digits

#[repr(u8)]
#[derive(Clone, Copy, Debug, Eq, PartialEq, TryFromPrimitive)]
pub enum ImplicitOps {
    BRK = 0x00,
    RTI = 0x40,
    RTS = 0x60,
    PHP = 0x08,
    CLC = 0x18,
    PLP = 0x28,
    SEC = 0x38,
    PHA = 0x48,
    CLI = 0x58,
    PLA = 0x68,
    SEI = 0x78,
    DEY = 0x88,
    TYA = 0x98,
    TAY = 0xA8,
    CLV = 0xB8,
    INY = 0xC8,
    CLD = 0xD8,
    INX = 0xE8,
    SED = 0xF8,
    TXA = 0x8A,
    TXS = 0x9A,
    TAX = 0xAA,
    TSX = 0xBA,
    DEX = 0xCA,
    NOP = 0xEA,
}

#[repr(u8)]
#[derive(Clone, Copy, Debug, Eq, PartialEq, TryFromPrimitive)]
pub enum ImmediateOps {
    NOP = 0x80,
    NOP1 = 0x82,
    LDX = 0xA2,
    NOP2 = 0xC2,
    NOP3 = 0xE2,
    NOP4 = 0x89,
    ANC = 0x0B,
    ANC_ = 0x2B,
    ALR = 0x4B,
    ARR = 0x6B,
    ANE = 0x8B, // Unstable
    LXA = 0xAB, // Unstable
    SBX = 0xCB, // Also called AXS.
    USBC = 0xEB, // Same as SBC 
}

#[derive(Debug, PartialEq)]
pub enum AddrMode { 
    Imm,
    Ind,
    Zp,
    ZpX,
    ZpY,
    ZpInd,
    Abs,
    AbsX,
    AbsY,
    AbsInd,
    IndX,
    IndrY,
    None
}

#[repr(u8)]
#[derive(Clone, Copy, Debug, Eq, PartialEq, TryFromPrimitive)]
pub enum Operation0 {
    JSR = 0x0,
    BIT = 0x1,
    JMP = 0x2,
    _JMP = 0x3,
    STY = 0x4,
    LDY = 0x5,
    CPY = 0x6,
    CPX = 0x7,
    SHY = 0x8
}

#[repr(u8)]
#[derive(Clone, Copy, Debug, Eq, PartialEq, TryFromPrimitive)]
pub enum Operation1 {
    ORA = 0x0,
    AND = 0x1,
    EOR = 0x2,
    ADC = 0x3,
    STA = 0x4,
    LDA = 0x5,
    CMP = 0x6,
    SBC = 0x7,
}

#[repr(u8)]
#[derive(Clone, Copy, Debug, Eq, PartialEq, TryFromPrimitive)]
pub enum Operation2 {
    ASL = 0x0,
    ROL = 0x1,
    LSR = 0x2,
    ROR = 0x3,
    STX = 0x4,
    LDX = 0x5,
    DEC = 0x6,
    INC = 0x7,
    JAM = 0x8, // KIL
    SHX = 0x9
}

#[repr(u8)]
#[derive(Clone, Copy, Debug, Eq, PartialEq, TryFromPrimitive)]
pub enum Operation3 {
    SLO = 0x0,
    RLA = 0x1,
    SRE = 0x2,
    RRA = 0x3,
    SAX = 0x4,
    LAX = 0x5,
    DCP = 0x6,
    ISC = 0x7,
    LAS = 0x8,
    SHA = 0x9, // Unstable
    TAS = 0xA, // Unstable
}

pub const ADDR0: [AddrMode; 8] = [
    AddrMode::Imm,
    AddrMode::Zp,
    AddrMode::Ind, // _JMP
    AddrMode::Abs,
    AddrMode::None,
    AddrMode::ZpX,
    AddrMode::AbsY,
    AddrMode::AbsX
];

pub const ADDR: [AddrMode; 8] = [
    AddrMode::IndX,
    AddrMode::Zp,
    AddrMode::Imm,
    AddrMode::Abs,
    AddrMode::IndrY,
    AddrMode::ZpInd, // X or Y
    AddrMode::AbsY,
    AddrMode::AbsInd // X or Y
];

pub const CYCLE_MASK: u8 = 0x7F;
pub const CYCLE_PAGE_CROSS_MASK: u8 = 0x80; // 0x80 = Intruction does not need to check if page is
                                        // crossed if Address Mode requires it.
pub const CYCLES: [u8; 0x100] = [
    // 0     1     2     3     4     5     6     7     8     9     A     B     C     D     E     F 
    0x07, 0x06, 0x00, 0x08, 0x03, 0x03, 0x05, 0x05, 0x03, 0x02, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, // 0
    0x02, 0x05, 0x00, 0x88, 0x04, 0x04, 0x06, 0x06, 0x02, 0x04, 0x00, 0x87, 0x04, 0x04, 0x87, 0x87, // 1
    0x06, 0x06, 0x00, 0x08, 0x03, 0x03, 0x05, 0x05, 0x04, 0x02, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, // 2
    0x02, 0x05, 0x00, 0x88, 0x04, 0x04, 0x06, 0x06, 0x02, 0x04, 0x00, 0x87, 0x04, 0x04, 0x87, 0x87, // 3
    0x06, 0x06, 0x00, 0x08, 0x03, 0x03, 0x05, 0x05, 0x03, 0x02, 0x02, 0x02, 0x03, 0x04, 0x06, 0x06, // 4
    0x02, 0x05, 0x00, 0x88, 0x04, 0x04, 0x06, 0x06, 0x02, 0x04, 0x00, 0x87, 0x04, 0x04, 0x87, 0x87, // 5
    0x06, 0x06, 0x00, 0x08, 0x03, 0x03, 0x05, 0x05, 0x04, 0x02, 0x02, 0x02, 0x05, 0x04, 0x06, 0x06, // 6
    0x02, 0x05, 0x00, 0x88, 0x04, 0x04, 0x06, 0x06, 0x02, 0x04, 0x00, 0x87, 0x04, 0x04, 0x87, 0x87, // 7
    0x00, 0x06, 0x02, 0x06, 0x03, 0x03, 0x03, 0x03, 0x02, 0x00, 0x02, 0x02, 0x04, 0x04, 0x04, 0x04, // 8
    0x02, 0x86, 0x00, 0x86, 0x04, 0x04, 0x04, 0x04, 0x02, 0x85, 0x02, 0x85, 0x85, 0x85, 0x85, 0x85, // 9
    0x02, 0x06, 0x02, 0x05, 0x03, 0x03, 0x03, 0x03, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04, 0x04, // A
    0x02, 0x05, 0x00, 0x08, 0x04, 0x04, 0x04, 0x04, 0x02, 0x04, 0x02, 0x04, 0x04, 0x04, 0x04, 0x04, // B
    0x02, 0x06, 0x02, 0x08, 0x03, 0x03, 0x05, 0x05, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, // C
    0x02, 0x05, 0x00, 0x88, 0x04, 0x04, 0x06, 0x06, 0x02, 0x04, 0x00, 0x87, 0x04, 0x04, 0x87, 0x87, // D
    0x02, 0x06, 0x02, 0x08, 0x03, 0x03, 0x05, 0x05, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06, // E
    0x02, 0x05, 0x00, 0x88, 0x04, 0x04, 0x06, 0x06, 0x02, 0x04, 0x00, 0x87, 0x04, 0x04, 0x87, 0x87, // F
];
